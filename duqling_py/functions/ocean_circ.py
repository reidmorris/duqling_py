"""
Stochastic Ocean Circulation Model.
"""

from typing import Optional
import numpy as np
from ..utils import register_function

U_DATA = np.array([[-7.284074e-03, -7.414825e-03, -7.668230e-03, -7.966879e-03,
                    -8.285770e-03, -8.203603e-03, -7.625472e-03, -7.275053e-03,
                    -7.041329e-03, -6.824117e-03, -6.306903e-03, -6.067243e-03,
                    -6.447969e-03, -7.005514e-03, -7.766360e-03, -7.830692e-03,
                    -7.190736e-03, -6.487080e-03, -6.094904e-03, -5.621447e-03,
                    -5.400722e-03, -5.315943e-03, -5.674061e-03, -5.929962e-03,
                    -5.588675e-03, -5.204036e-03, -4.469410e-03, -3.963077e-03,
                    -3.459391e-03, -1.888023e-03, -7.305593e-04,  3.609377e-05,
                    3.522149e-04,  4.957701e-04,  4.164058e-04,  2.726967e-05,
                    0.000000e+00],
                [ 5.884003e-03,  5.754012e-03,  5.313111e-03,  4.728601e-03,
                    4.582213e-03,  4.621281e-03,  4.998000e-03,  5.242717e-03,
                    5.406545e-03,  5.378611e-03,  5.319459e-03,  5.264658e-03,
                    4.936816e-03,  4.107843e-03,  2.806809e-03,  1.308965e-03,
                    -8.260377e-05, -7.146830e-04, -8.918723e-04, -1.013230e-03,
                    -1.677326e-03, -2.498551e-03, -3.330589e-03, -4.099150e-03,
                    -4.893292e-03, -5.037559e-03, -4.720440e-03, -4.023034e-03,
                    -3.533602e-03, -2.465678e-03, -1.279132e-03, -4.638261e-04,
                    3.236671e-04,  5.678750e-04,  6.390574e-04,  3.671549e-04,
                    0.000000e+00],
                [ 1.321966e-02,  1.344249e-02,  1.329587e-02,  1.275927e-02,
                    1.299326e-02,  1.343476e-02,  1.366580e-02,  1.409130e-02,
                    1.413825e-02,  1.392907e-02,  1.332112e-02,  1.275277e-02,
                    1.200262e-02,  1.083292e-02,  9.250708e-03,  7.167488e-03,
                    5.287811e-03,  4.589093e-03,  4.676803e-03,  4.353597e-03,
                    3.348924e-03,  2.045954e-03,  9.060159e-04, -1.551123e-04,
                    -1.600482e-03, -2.247444e-03, -2.332525e-03, -1.882550e-03,
                    -1.413161e-03, -1.394580e-03, -1.029657e-03, -4.220764e-04,
                    3.900549e-04,  9.527769e-04,  1.360097e-03,  9.959172e-04,
                    0.000000e+00],
                [ 6.745597e-03,  7.423414e-03,  7.987552e-03,  8.571355e-03,
                    8.638205e-03,  8.312348e-03,  7.918018e-03,  7.885862e-03,
                    7.528776e-03,  6.785138e-03,  6.003026e-03,  5.220582e-03,
                    4.745910e-03,  4.619867e-03,  4.588425e-03,  3.932637e-03,
                    3.505853e-03,  3.633544e-03,  3.974884e-03,  3.959336e-03,
                    3.357960e-03,  2.807756e-03,  2.061655e-03,  8.124336e-04,
                    -3.264306e-04, -1.326053e-03, -1.883085e-03, -2.071640e-03,
                    -1.630970e-03, -1.746796e-03, -2.069820e-03, -2.132274e-03,
                    -2.106572e-03, -1.680640e-03, -1.021650e-03, -6.368592e-04,
                    0.000000e+00],
                [ 5.763606e-03,  6.494166e-03,  7.301805e-03,  8.192044e-03,
                    8.249819e-03,  7.780780e-03,  7.791143e-03,  8.553371e-03,
                    8.398230e-03,  7.949203e-03,  8.060551e-03,  8.331802e-03,
                    9.163750e-03,  1.064340e-02,  1.195703e-02,  1.146548e-02,
                    1.096734e-02,  1.120306e-02,  1.126288e-02,  1.096686e-02,
                    1.005851e-02,  1.000172e-02,  8.796604e-03,  6.628464e-03,
                    4.412488e-03,  2.492368e-03,  1.438719e-03,  8.679271e-04,
                    7.712721e-04,  5.000695e-04,  8.336405e-05, -4.244385e-04,
                    -1.120386e-03, -1.428353e-03, -1.286080e-03, -6.805440e-04,
                    0.000000e+00],
                [-1.184938e-02, -1.104885e-02, -9.882469e-03, -8.443547e-03,
                    -7.139139e-03, -5.818619e-03, -4.818745e-03, -4.355905e-03,
                    -3.797699e-03, -3.214850e-03, -2.543406e-03, -1.761768e-03,
                    -9.184045e-04,  2.111308e-04,  1.400723e-03,  2.789500e-03,
                    3.222760e-03,  2.811817e-03,  2.284013e-03,  1.801462e-03,
                    1.729062e-03,  1.676320e-03,  1.629572e-03,  1.628643e-03,
                    1.276153e-03,  9.379844e-04,  5.292304e-04,  1.139341e-04,
                    -1.773088e-04, -2.271047e-05,  4.004010e-04,  5.598305e-04,
                    2.299133e-04,  2.342282e-04, -2.444318e-05,  1.850452e-04,
                    0.000000e+00],
                [-2.257290e-02, -2.183058e-02, -2.077417e-02, -1.919579e-02,
                    -1.793822e-02, -1.671746e-02, -1.642257e-02, -1.744349e-02,
                    -1.728194e-02, -1.696890e-02, -1.703650e-02, -1.697571e-02,
                    -1.686425e-02, -1.694546e-02, -1.658929e-02, -1.494196e-02,
                    -1.454005e-02, -1.592936e-02, -1.740889e-02, -1.823560e-02,
                    -1.786786e-02, -1.760273e-02, -1.587223e-02, -1.355946e-02,
                    -1.133741e-02, -9.776557e-03, -9.265282e-03, -9.033162e-03,
                    -9.015991e-03, -8.209000e-03, -7.321493e-03, -6.741008e-03,
                    -6.099138e-03, -5.063713e-03, -4.175433e-03, -3.070502e-03,
                    0.000000e+00],
                [-8.562130e-03, -7.908578e-03, -7.057022e-03, -6.058091e-03,
                    -5.439597e-03, -5.085931e-03, -5.325448e-03, -5.779383e-03,
                    -6.037919e-03, -5.584400e-03, -5.138042e-03, -4.712300e-03,
                    -4.236766e-03, -3.638008e-03, -3.134282e-03, -2.496478e-03,
                    -2.290534e-03, -2.998917e-03, -4.187462e-03, -5.356725e-03,
                    -5.833376e-03, -5.812103e-03, -4.945509e-03, -3.714291e-03,
                    -2.671102e-03, -2.143703e-03, -2.189469e-03, -2.570679e-03,
                    -3.224007e-03, -3.581024e-03, -3.949008e-03, -4.441493e-03,
                    -4.763580e-03, -4.575841e-03, -4.076337e-03, -3.310398e-03,
                    0.000000e+00],
                [-3.576968e-03, -2.958975e-03, -2.012022e-03, -8.009155e-04,
                    1.258884e-04,  4.389473e-04,  1.998688e-04, -6.107404e-04,
                    -1.448543e-03, -2.107048e-03, -2.562163e-03, -2.644624e-03,
                    -2.434804e-03, -1.683386e-03, -7.191606e-04,  5.644507e-04,
                    1.823142e-03,  2.564590e-03,  2.869529e-03,  2.817245e-03,
                    2.743150e-03,  2.650563e-03,  2.744744e-03,  2.885444e-03,
                    2.937903e-03,  2.817124e-03,  2.327512e-03,  1.603487e-03,
                    8.145079e-04,  1.134672e-04, -5.950877e-04, -1.054551e-03,
                    -1.402313e-03, -1.418016e-03, -1.166931e-03, -7.593429e-04,
                    0.000000e+00],
                [ 8.941591e-03,  9.363875e-03,  9.838741e-03,  1.011091e-02,
                    1.040785e-02,  1.010026e-02,  9.644184e-03,  8.816276e-03,
                    8.006132e-03,  6.598272e-03,  5.119365e-03,  4.156039e-03,
                    3.330652e-03,  2.793819e-03,  2.652787e-03,  2.792493e-03,
                    3.124751e-03,  3.409017e-03,  3.409706e-03,  3.351891e-03,
                    3.149371e-03,  2.999662e-03,  2.699136e-03,  2.260797e-03,
                    1.979881e-03,  1.679292e-03,  1.084728e-03,  4.937107e-04,
                    -1.382546e-04, -8.916830e-04, -1.448192e-03, -1.470832e-03,
                    -1.173716e-03, -8.825048e-04, -4.272464e-04,  2.109535e-04,
                    0.000000e+00],
                [ 1.522171e-02,  1.509538e-02,  1.465642e-02,  1.359776e-02,
                    1.259089e-02,  1.149428e-02,  1.081711e-02,  1.054609e-02,
                    1.047086e-02,  1.033551e-02,  1.004102e-02,  9.573046e-03,
                    9.325896e-03,  9.095751e-03,  8.784004e-03,  8.422685e-03,
                    8.121883e-03,  7.966571e-03,  7.581634e-03,  6.967580e-03,
                    5.954344e-03,  4.784589e-03,  3.611111e-03,  2.519613e-03,
                    1.622256e-03,  7.786601e-04,  7.292518e-05, -5.561102e-04,
                    -6.267716e-04, -8.596186e-04, -8.452911e-04, -5.877467e-04,
                    -2.258825e-04,  9.813025e-05,  2.302158e-04,  4.198975e-04,
                    0.000000e+00],
                [ 1.001173e-02,  9.358569e-03,  8.545341e-03,  7.570772e-03,
                    6.647437e-03,  5.934998e-03,  5.628030e-03,  5.501996e-03,
                    5.518063e-03,  5.679664e-03,  5.915860e-03,  5.919989e-03,
                    6.194122e-03,  6.293201e-03,  6.347086e-03,  6.470850e-03,
                    6.697747e-03,  6.872653e-03,  7.005820e-03,  6.745574e-03,
                    5.999506e-03,  4.754555e-03,  3.611497e-03,  2.618325e-03,
                    1.792802e-03,  1.100673e-03,  6.681646e-04,  3.625917e-04,
                    4.509422e-04,  7.973695e-04,  1.208128e-03,  1.567559e-03,
                    2.081106e-03,  2.349975e-03,  2.309400e-03,  1.672279e-03,
                    0.000000e+00],
                [ 7.793422e-03,  6.920158e-03,  5.934308e-03,  4.975101e-03,
                    4.341459e-03,  3.986838e-03,  3.780787e-03,  3.820681e-03,
                    3.769227e-03,  3.736634e-03,  3.691914e-03,  3.790800e-03,
                    3.782876e-03,  3.611671e-03,  3.672262e-03,  3.815990e-03,
                    3.898297e-03,  3.506316e-03,  3.070762e-03,  2.539913e-03,
                    2.093232e-03,  1.547392e-03,  9.810560e-04,  7.248769e-04,
                    4.756915e-04,  3.658971e-04,  4.847546e-04,  7.294967e-04,
                    8.441223e-04,  1.295498e-03,  1.858115e-03,  2.590264e-03,
                    3.609919e-03,  3.864073e-03,  3.879799e-03,  3.093878e-03,
                    0.000000e+00],
                [-5.717909e-03, -6.579591e-03, -7.467021e-03, -8.126555e-03,
                    -8.438928e-03, -8.616384e-03, -8.622256e-03, -8.287004e-03,
                    -7.990520e-03, -7.633694e-03, -7.168250e-03, -6.511106e-03,
                    -5.651393e-03, -4.567715e-03, -3.582653e-03, -3.023457e-03,
                    -2.638298e-03, -2.617319e-03, -2.693684e-03, -2.674242e-03,
                    -2.656893e-03, -2.619990e-03, -2.687389e-03, -2.519662e-03,
                    -2.153036e-03, -1.557341e-03, -6.896428e-04,  1.685944e-04,
                    7.072405e-04,  1.324037e-03,  2.168978e-03,  3.298199e-03,
                    4.268158e-03,  4.366069e-03,  4.328575e-03,  3.610790e-03,
                    0.000000e+00],
                [-7.119768e-03, -7.693299e-03, -8.220295e-03, -8.284981e-03,
                    -8.214158e-03, -7.960352e-03, -7.695985e-03, -7.244717e-03,
                    -6.773562e-03, -6.447372e-03, -5.929078e-03, -5.361971e-03,
                    -4.531065e-03, -3.432933e-03, -2.491950e-03, -1.792528e-03,
                    -1.206674e-03, -7.675865e-04, -3.523937e-04,  1.020833e-04,
                    4.774646e-04,  9.211893e-04,  1.268278e-03,  1.672776e-03,
                    2.321054e-03,  3.046530e-03,  3.806781e-03,  4.478488e-03,
                    4.720667e-03,  4.748170e-03,  4.879287e-03,  4.883663e-03,
                    4.711634e-03,  4.198546e-03,  3.591520e-03,  2.579339e-03,
                    0.000000e+00],
                [ 1.476735e-02,  1.431716e-02,  1.387061e-02,  1.348495e-02,
                    1.321245e-02,  1.322808e-02,  1.308571e-02,  1.292051e-02,
                    1.254718e-02,  1.209811e-02,  1.157344e-02,  1.109256e-02,
                    1.051379e-02,  9.809262e-03,  8.986707e-03,  8.226707e-03,
                    7.220266e-03,  6.393874e-03,  5.571519e-03,  4.679274e-03,
                    4.006596e-03,  3.660933e-03,  3.644224e-03,  3.755824e-03,
                    4.056389e-03,  4.313816e-03,  4.621438e-03,  4.713970e-03,
                    4.565898e-03,  4.118973e-03,  3.450454e-03,  2.394652e-03,
                    1.307047e-03,  6.742995e-04,  2.281969e-04, -2.162084e-04,
                    0.000000e+00],
                [ 2.263531e-02,  2.220624e-02,  2.192414e-02,  2.154698e-02,
                    2.098615e-02,  2.032270e-02,  1.979659e-02,  1.909018e-02,
                    1.835332e-02,  1.772029e-02,  1.685587e-02,  1.595927e-02,
                    1.482778e-02,  1.354885e-02,  1.220738e-02,  1.084512e-02,
                    9.467207e-03,  8.450789e-03,  7.296483e-03,  6.108255e-03,
                    5.131183e-03,  4.441058e-03,  4.065154e-03,  3.779169e-03,
                    3.599875e-03,  3.513143e-03,  3.324458e-03,  3.245887e-03,
                    3.313781e-03,  3.221530e-03,  2.854649e-03,  1.973112e-03,
                    7.951467e-04,  8.523111e-05, -5.395742e-04, -7.054443e-04,
                    0.000000e+00],
                [ 3.263369e-03,  2.972168e-03,  2.689476e-03,  2.258579e-03,
                    1.927790e-03,  1.694545e-03,  1.627742e-03,  1.670214e-03,
                    1.716110e-03,  1.832085e-03,  1.966647e-03,  2.096307e-03,
                    2.263285e-03,  2.368526e-03,  2.651749e-03,  2.945148e-03,
                    3.425237e-03,  3.699281e-03,  3.520929e-03,  3.322655e-03,
                    3.036379e-03,  2.853660e-03,  2.632247e-03,  2.529920e-03,
                    2.367436e-03,  2.495070e-03,  2.470294e-03,  2.758206e-03,
                    3.199613e-03,  3.665659e-03,  3.813146e-03,  3.685096e-03,
                    3.232446e-03,  2.586706e-03,  1.641911e-03,  1.061703e-03,
                    0.000000e+00],
                [-1.345295e-02, -1.372987e-02, -1.407652e-02, -1.459994e-02,
                    -1.463584e-02, -1.416729e-02, -1.363987e-02, -1.296407e-02,
                    -1.241398e-02, -1.175171e-02, -1.081819e-02, -9.803301e-03,
                    -8.574985e-03, -7.333212e-03, -5.893084e-03, -4.380498e-03,
                    -2.840665e-03, -1.893681e-03, -1.382244e-03, -9.644352e-04,
                    -9.038405e-04, -9.875268e-04, -1.153986e-03, -1.126871e-03,
                    -9.755842e-04, -3.121500e-04,  5.295490e-04,  1.578612e-03,
                    2.627228e-03,  3.689536e-03,  4.330450e-03,  4.838851e-03,
                    4.928802e-03,  4.382617e-03,  3.426107e-03,  2.461874e-03,
                    0.000000e+00]])
V_DATA = np.array([[2.519374e-03,  2.401148e-03,  2.574838e-03,  2.099935e-03,
                    1.193093e-03,  5.607590e-04, -3.723790e-04, -9.064287e-04,
                    -1.653895e-03, -1.526728e-03, -6.064426e-04,  2.998796e-04,
                    1.022362e-03,  5.221500e-04, -7.400022e-04, -2.237795e-03,
                    -2.656067e-03, -2.885628e-03, -4.202541e-03, -5.767933e-03,
                    -5.375327e-03, -4.609384e-03, -4.533393e-03, -4.474901e-03,
                    -2.820180e-03, -1.334057e-03,  7.470458e-05,  9.004473e-04,
                    2.444924e-03,  2.945531e-03,  2.556110e-03,  2.272748e-03,
                    2.371811e-03,  2.150328e-03,  7.736310e-04, -2.415920e-05,
                    -6.120969e-04],
                [ 2.808728e-03,  2.850993e-03,  3.093590e-03,  2.624783e-03,
                    1.135414e-03, -1.954657e-04, -8.625994e-04, -1.262827e-03,
                    -2.021414e-03, -2.293977e-03, -9.574376e-04,  8.278153e-04,
                    1.821559e-03,  1.573737e-03, -6.861471e-04, -3.202733e-03,
                    -3.725787e-03, -3.544663e-03, -5.030327e-03, -6.324154e-03,
                    -5.730275e-03, -4.331520e-03, -4.390285e-03, -5.136238e-03,
                    -3.466096e-03, -2.386508e-03, -6.062310e-04,  2.600109e-04,
                    4.306469e-04,  1.513013e-03,  1.634332e-03,  1.947160e-03,
                    2.283870e-03,  2.353738e-03,  1.334120e-03, -1.455858e-04,
                    -4.822668e-04],
                [ 3.138383e-03,  3.864530e-03,  4.449523e-03,  2.745724e-03,
                    1.195692e-03, -4.760808e-04, -1.116024e-03, -1.469566e-03,
                    -1.771039e-03, -1.585463e-03, -5.495498e-04,  1.264863e-03,
                    3.436569e-03,  4.188656e-03,  3.243089e-03,  1.218230e-03,
                    -1.302693e-03, -2.744502e-03, -4.353893e-03, -4.575646e-03,
                    -3.701730e-03, -2.773259e-03, -2.874444e-03, -2.817928e-03,
                    -2.760537e-03, -2.418611e-03, -1.868077e-03, -3.976572e-04,
                    -4.004874e-04, -1.173668e-04,  5.081887e-04,  3.298088e-04,
                    1.929395e-03,  2.182236e-03,  1.635688e-03,  7.283902e-04,
                    -4.321051e-04],
                [ 2.525763e-03,  3.640534e-03,  4.996704e-03,  2.271702e-03,
                    6.372397e-05, -8.684123e-04, -2.126209e-03, -1.539187e-03,
                    -1.636270e-03, -8.121025e-04,  5.228601e-04,  2.984077e-03,
                    5.332779e-03,  6.276457e-03,  5.274471e-03,  2.001774e-03,
                    -1.969799e-03, -4.060984e-03, -4.599746e-03, -4.074201e-03,
                    -2.585163e-03, -1.532592e-03, -1.814654e-03, -1.516304e-03,
                    -1.998328e-03, -2.402636e-03, -2.012530e-03, -1.049146e-03,
                    3.396732e-04,  5.147305e-04,  4.382779e-05, -2.143710e-04,
                    9.592188e-04,  1.474843e-03,  2.484886e-03,  1.643320e-03,
                    4.508084e-04],
                [ 1.581377e-03,  2.736199e-03,  3.415709e-03,  2.812383e-03,
                    2.083375e-03,  4.951875e-04, -1.260660e-03, -6.719934e-04,
                    6.072110e-05,  4.400504e-04,  1.622254e-03,  2.872782e-03,
                    4.357998e-03,  4.957125e-03,  5.589985e-03,  2.589763e-03,
                    -1.862330e-03, -4.109317e-03, -4.812786e-03, -3.393850e-03,
                    -2.496142e-03, -9.235446e-04,  3.044449e-04,  9.516946e-05,
                    -2.762943e-04, -1.174661e-03, -1.577598e-03, -1.702976e-03,
                    -5.043616e-05,  8.117759e-04,  6.817614e-04,  2.369997e-04,
                    8.826073e-04,  5.616777e-04,  8.662409e-04, -1.977474e-04,
                    -9.992720e-04],
                [ 7.359905e-04,  1.777391e-03,  2.989689e-03,  2.444255e-03,
                    1.574960e-03, -8.385426e-04, -4.333767e-03, -1.198399e-03,
                    -4.154832e-04, -1.061633e-03, -2.070787e-05,  1.071179e-03,
                    1.842803e-03,  3.305221e-03,  7.256427e-03,  3.650842e-03,
                    -2.824578e-03, -4.702939e-03, -4.362180e-03, -2.015706e-03,
                    -2.723380e-03,  1.616777e-03,  4.081123e-03,  4.484326e-03,
                    3.159209e-03,  3.079759e-04, -6.541433e-04, -9.869317e-04,
                    1.066813e-03,  1.735910e-03,  1.496029e-03,  1.694393e-03,
                    1.894771e-03,  1.155940e-03,  9.494420e-04,  3.164888e-04,
                    -2.016838e-04],
                [-4.896996e-04, -1.927001e-04, -9.728530e-05, -4.056529e-04,
                    -1.287631e-03, -2.312875e-03, -3.057032e-03, -2.331579e-03,
                    -1.566939e-03, -1.508381e-03, -4.930184e-04,  7.280823e-04,
                    1.536910e-03,  2.157771e-03,  2.749513e-03,  1.878156e-03,
                    -1.107062e-03, -3.274591e-03, -4.057479e-03, -3.451830e-03,
                    -2.696319e-03, -5.937182e-04,  8.205524e-04,  1.612258e-03,
                    1.035315e-03, -3.109025e-05, -5.374287e-04, -1.039988e-03,
                    -3.340407e-04, -1.133779e-04,  4.391186e-04,  1.341963e-03,
                    1.109399e-03,  1.406305e-03,  4.195043e-04, -2.092306e-05,
                    -6.614932e-04],
                [-1.336964e-03, -1.104214e-03, -1.289679e-03, -1.009993e-03,
                    -1.899713e-03, -1.950303e-03, -1.990222e-03, -1.952195e-03,
                    -1.474749e-03, -1.084114e-03, -2.521315e-04,  8.689753e-04,
                    2.271413e-03,  2.636065e-03,  3.177882e-03,  2.820085e-03,
                    7.799954e-04, -1.149443e-03, -2.679663e-03, -3.479237e-03,
                    -3.806769e-03, -3.141399e-03, -2.058326e-03, -1.302241e-03,
                    -9.187573e-04, -1.078149e-03, -1.354677e-03, -1.174793e-03,
                    -1.159870e-03, -6.782999e-04, -1.321861e-05,  1.420284e-04,
                    -7.529070e-04, -1.053679e-03, -1.979966e-03, -3.524698e-03,
                    -4.752513e-03],
                [-2.453665e-03, -2.657478e-03, -2.987770e-03, -2.226574e-03,
                    -2.524167e-03, -1.953602e-03, -2.124121e-03, -1.921179e-03,
                    -3.010561e-03, -2.875009e-03, -1.680988e-03, -4.288766e-04,
                    2.540874e-04,  1.185667e-03,  1.495055e-03,  1.738115e-03,
                    9.228348e-04, -2.319128e-04, -1.292958e-03, -2.677460e-03,
                    -3.316187e-03, -3.400068e-03, -2.811338e-03, -1.399716e-03,
                    -5.258994e-04, -6.665587e-05,  2.928212e-04,  5.523341e-04,
                    4.595877e-04,  7.810331e-04,  1.768284e-03,  2.233541e-03,
                    4.906917e-04, -9.942510e-05, -1.943207e-03, -4.175211e-03,
                    -6.677519e-03],
                [-3.403068e-03, -4.092313e-03, -5.045033e-03, -3.874141e-03,
                    -3.152985e-03, -1.619197e-03, -1.418432e-04,  2.422951e-06,
                    -1.804565e-04, -3.176953e-04, -3.003698e-04,  2.326880e-04,
                    2.814028e-04,  2.211165e-04, -5.042489e-05, -3.016641e-04,
                    -1.075203e-03, -2.011061e-03, -2.746876e-03, -3.710805e-03,
                    -4.091375e-03, -3.944337e-03, -2.892051e-03, -1.669799e-03,
                    -6.771256e-04,  2.344597e-04,  6.494983e-04,  1.046803e-03,
                    8.090801e-04,  1.362806e-03,  1.513852e-03,  1.442226e-03,
                    -6.313259e-04, -1.748364e-03, -3.395036e-03, -5.294736e-03,
                    -6.785280e-03],
                [-4.198237e-03, -4.666316e-03, -4.617634e-03, -3.715829e-03,
                    -2.251642e-03, -1.007848e-03,  8.846016e-05,  2.689367e-04,
                    7.626812e-04,  1.066027e-03,  8.695347e-04,  1.843275e-03,
                    1.754963e-03,  1.606053e-03,  1.108502e-03,  7.866114e-04,
                    -3.609228e-05, -5.902320e-04, -1.623565e-03, -2.787801e-03,
                    -3.636706e-03, -3.286903e-03, -2.139162e-03, -9.364009e-04,
                    1.665399e-04,  1.581927e-03,  2.005389e-03,  2.445994e-03,
                    2.639411e-03,  2.526761e-03,  2.097802e-03,  1.686099e-03,
                    -4.083157e-04, -1.639824e-03, -4.269938e-03, -5.616789e-03,
                    -6.806914e-03],
                [-3.885847e-03, -3.822007e-03, -3.090216e-03, -1.882199e-03,
                    -6.310753e-04,  1.323087e-05,  6.080711e-04,  2.585318e-04,
                    3.351646e-04,  6.875485e-04,  1.135204e-03,  1.262623e-03,
                    1.248016e-03,  1.379004e-03,  1.143839e-03,  6.657988e-04,
                    -6.624910e-04, -1.086544e-03, -1.405914e-03, -1.519471e-03,
                    -1.643670e-03, -1.417891e-03, -3.618555e-04,  5.718038e-04,
                    1.635704e-03,  2.452552e-03,  2.743425e-03,  1.718018e-03,
                    1.956635e-03,  1.820160e-03,  1.229606e-03,  7.951847e-04,
                    -1.587254e-03, -2.427324e-03, -4.746052e-03, -5.876200e-03,
                    -7.508053e-03],
                [-3.286132e-03, -3.307600e-03, -2.662089e-03, -1.633515e-03,
                    -4.646100e-04, -1.752628e-04,  5.626709e-04,  2.822696e-04,
                    3.995125e-04,  5.785790e-04,  1.107678e-03,  1.379616e-03,
                    1.761213e-03,  1.763258e-03,  1.025162e-03,  3.195437e-04,
                    -6.543238e-04, -1.188786e-03, -1.228883e-03, -1.104979e-03,
                    -6.326919e-04, -5.087161e-04,  4.657791e-04,  1.420446e-03,
                    2.396490e-03,  3.289527e-03,  3.433778e-03,  2.584474e-03,
                    2.132745e-03,  1.816246e-03,  1.396325e-03,  4.726718e-04,
                    -1.483603e-03, -2.063205e-03, -3.590129e-03, -4.725082e-03,
                    -6.117865e-03],
                [-2.342641e-03, -1.979853e-03, -1.159530e-03, -5.757302e-04,
                    2.119045e-04,  5.265695e-04,  6.401556e-04,  4.678003e-04,
                    5.225881e-04,  9.522921e-04,  1.143357e-03,  1.627091e-03,
                    2.148701e-03,  1.653695e-03,  1.010261e-03,  5.227957e-04,
                    2.342832e-04, -2.048963e-04, -2.766697e-04, -5.869101e-04,
                    -3.256574e-04, -1.365772e-05,  4.463901e-04,  1.598524e-03,
                    2.528372e-03,  2.949265e-03,  2.935747e-03,  2.050851e-03,
                    1.266949e-03,  7.511054e-04, -4.020990e-04, -1.843280e-03,
                    -2.643111e-03, -2.982844e-03, -3.514526e-03, -3.671105e-03,
                    -4.046966e-03],
                [-1.627169e-03, -1.475273e-03, -1.211126e-03, -9.538605e-04,
                    7.561667e-05, -8.763368e-06, -1.603707e-04, -3.852772e-04,
                    -4.154773e-04, -4.070872e-04, -3.414853e-04, -4.786665e-04,
                    -5.532599e-04, -4.262289e-04, -1.973173e-04, -5.719577e-04,
                    -6.440268e-04, -1.040983e-03, -1.360555e-03, -1.319758e-03,
                    -8.255724e-04, -3.304626e-04,  1.401147e-04,  8.867217e-04,
                    1.509578e-03,  1.787813e-03,  1.953764e-03,  1.715181e-03,
                    8.280047e-04, -2.526903e-04, -1.770830e-03, -2.676223e-03,
                    -2.504241e-03, -2.815028e-03, -2.655286e-03, -1.758835e-03,
                    -1.532176e-03],
                [-1.339151e-03, -1.051057e-03, -1.391585e-03, -1.087622e-03,
                    -4.486995e-04, -1.909170e-04, -6.334421e-04, -9.350841e-04,
                    -4.986529e-04, -5.853541e-04, -5.042113e-04, -7.795537e-04,
                    -1.005287e-03, -1.032850e-03, -9.464814e-04, -1.252852e-03,
                    -1.168878e-03, -1.676840e-03, -1.962155e-03, -2.044902e-03,
                    -1.802347e-03, -1.062816e-03, -5.998475e-04,  1.442148e-04,
                    1.074646e-03,  1.495043e-03,  1.776593e-03,  1.972507e-03,
                    1.470786e-03,  3.118261e-04, -1.008870e-03, -2.277394e-03,
                    -2.097622e-03, -2.287859e-03, -1.670791e-03, -1.198194e-03,
                    -6.539001e-04],
                [-9.543080e-04, -6.952739e-04, -7.340596e-04, -6.591095e-04,
                    -1.489224e-04,  2.984889e-04,  2.886971e-05,  2.438947e-04,
                    5.957691e-04,  7.732353e-04,  7.534443e-04,  7.690222e-04,
                    9.426174e-04,  1.377505e-03,  1.472358e-03,  1.639411e-03,
                    1.114784e-03,  5.005861e-04,  2.540209e-04, -3.322591e-04,
                    -6.234338e-04, -7.170405e-04, -4.051911e-04,  1.329100e-04,
                    1.250334e-03,  1.563659e-03,  2.425328e-03,  2.916674e-03,
                    2.633441e-03,  1.680908e-03,  6.730439e-04, -6.616683e-04,
                    -1.646094e-03, -2.538630e-03, -2.132812e-03, -2.437245e-03,
                    -2.190498e-03],
                [-6.685674e-04, -6.449640e-04, -7.484664e-04,  9.042837e-05,
                    1.268202e-03,  1.384140e-03,  1.290659e-03,  1.181579e-03,
                    1.517721e-03,  2.147360e-03,  2.305428e-03,  2.672861e-03,
                    2.934694e-03,  3.299048e-03,  3.490287e-03,  3.311795e-03,
                    2.149803e-03,  1.699685e-03,  1.379676e-03,  4.256961e-04,
                    -2.565797e-04, -4.143409e-04, -3.457518e-05,  6.969437e-04,
                    1.949988e-03,  2.806523e-03,  3.232153e-03,  3.284025e-03,
                    3.069984e-03,  2.165068e-03,  1.718802e-03,  5.673350e-04,
                    -1.022567e-03, -1.900350e-03, -2.315709e-03, -3.140022e-03,
                    -2.990896e-03],
                [-6.304911e-04, -3.780950e-04, -8.802005e-05,  2.976308e-04,
                    1.360260e-03,  1.438129e-03,  8.083858e-04,  9.385686e-04,
                    1.333951e-03,  1.897457e-03,  2.000435e-03,  2.169747e-03,
                    2.691643e-03,  2.897924e-03,  3.097794e-03,  2.636565e-03,
                    1.863688e-03,  2.160385e-03,  1.745916e-03,  7.364844e-04,
                    -3.073620e-04, -4.056829e-04, -1.525698e-04,  1.054993e-03,
                    2.256529e-03,  3.575294e-03,  3.886715e-03,  3.999151e-03,
                    3.500994e-03,  2.782470e-03,  2.210125e-03,  9.549033e-04,
                    -6.092970e-04, -1.301735e-03, -2.169160e-03, -2.792495e-03,
                    -3.213777e-03]])
OXY_DATA = np.array([[232.38053   , 231.14017   , 229.3396    , 228.474645  ,
                    227.22424333, 225.49813   , 228.12038   , 228.12038   ,
                    228.12038   , 224.171765  , 224.60741   , 226.331035  ,
                    226.331035  , 226.331035  , 222.784635  , 222.139165  ,
                    221.0562    , 219.46516   , 219.037625  , 219.71448   ,
                    219.71448   , 219.71448   , 219.72874   , 219.72874   ,
                    219.72874   , 218.69155667, 217.86708   , 219.285716  ,
                    218.0591375 , 219.580462  , 222.1882    , 223.7396    ,
                    220.51432667, 222.964482  , 217.9866    , 217.9866    ,
                    217.9866    ],
                [232.38053   , 231.14017   , 229.3396    , 228.474645  ,
                    227.22424333, 225.49813   , 225.78559   , 226.92464   ,
                    224.33429   , 224.171765  , 224.60741   , 224.54399   ,
                    224.971672  , 222.0009    , 222.784635  , 222.139165  ,
                    221.0562    , 219.46516   , 219.037625  , 218.093185  ,
                    219.3081975 , 218.60893   , 219.02747667, 218.25082   ,
                    218.88135667, 218.69155667, 217.86708   , 219.285716  ,
                    218.0591375 , 219.580462  , 222.1882    , 223.7396    ,
                    220.51432667, 222.964482  , 222.685912  , 224.63611556,
                    224.10045   ],
                [232.38053   , 231.14017   , 229.3396    , 228.474645  ,
                    227.22424333, 225.49813   , 231.794265  , 231.794265  ,
                    231.794265  , 224.171765  , 235.70459   , 229.385275  ,
                    229.385275  , 228.17778   , 228.17778   , 224.81263   ,
                    224.02277   , 222.46056   , 221.12027   , 221.82105   ,
                    220.09887   , 220.09887   , 219.02747667, 218.73951   ,
                    218.73951   , 221.16914   , 221.16914   , 219.285716  ,
                    221.482365  , 221.482365  , 220.231355  , 214.9476125 ,
                    221.28623333, 219.2168225 , 219.10329333, 221.88907   ,
                    221.88907   ],
                [250.55278   , 247.788015  , 247.788015  , 242.133945  ,
                    246.40317   , 239.60508   , 234.78661333, 234.78661333,
                    237.313045  , 235.70459   , 235.70459   , 236.344     ,
                    236.08545   , 228.212885  , 228.212885  , 228.212885  ,
                    224.02277   , 222.46056   , 221.12027   , 221.27686333,
                    221.27686333, 221.27686333, 221.27686333, 218.73951   ,
                    218.73951   , 224.70938   , 224.70938   , 224.70938   ,
                    232.93      , 221.482365  , 220.231355  , 214.9476125 ,
                    221.28623333, 219.2168225 , 224.615168  , 224.615168  ,
                    220.193635  ],
                [250.55278   , 247.788015  , 247.788015  , 242.133945  ,
                    246.40317   , 239.60508   , 240.25868   , 240.25868   ,
                    240.25868   , 244.1       , 235.70459   , 239.97647333,
                    239.97647333, 239.97647333, 228.212885  , 239.65081   ,
                    228.45      , 233.7       , 229.15      , 225.43096   ,
                    225.43096   , 225.43096   , 236.3       , 236.7       ,
                    232.8       , 233.25      , 226.60297   , 226.60297   ,
                    232.93      , 232.93      , 232.6       , 232.6       ,
                    226.35775333, 229.35598   , 229.35598   , 229.86228   ,
                    229.86228   ],
                [251.876595  , 251.46843333, 257.35      , 252.4       ,
                    251.5       , 251.5       , 232.35      , 247.44048   ,
                    246.7       , 244.1       , 242.55      , 244.5       ,
                    245.1182675 , 245.2       , 246.05      , 239.65081   ,
                    228.45      , 233.7       , 229.15      , 231.95      ,
                    228.833732  , 233.26666667, 236.3       , 236.7       ,
                    232.8       , 233.25      , 236.3       , 231.5       ,
                    233.75686   , 231.5       , 232.6       , 232.6       ,
                    226.35775333, 232.04578   , 227.35598333, 228.        ,
                    228.        ],
                [252.19312333, 252.19312333, 253.89298   , 251.9       ,
                    251.9       , 251.5       , 251.20589   , 251.20589   ,
                    251.20589   , 244.1       , 242.55      , 249.55377333,
                    249.55377333, 249.55377333, 247.86546333, 247.86546333,
                    247.86546333, 233.7       , 229.15      , 239.489585  ,
                    239.489585  , 239.489585  , 236.3       , 236.7       ,
                    232.8       , 233.25      , 236.3       , 237.26667   ,
                    237.26667   , 237.26667   , 232.6       , 235.0003925 ,
                    235.0003925 , 230.0150125 , 230.0150125 , 228.        ,
                    228.        ],
                [252.09241   , 251.35024667, 251.35024667, 251.1       ,
                    251.1       , 253.34643   , 250.792276  , 250.792276  ,
                    250.792276  , 251.26375667, 246.78887   , 248.22416   ,
                    248.22416   , 248.22416   , 243.26358   , 243.26358   ,
                    243.26358   , 242.080385  , 240.81624   , 240.29788   ,
                    240.29788   , 240.29788   , 237.493235  , 236.74546   ,
                    239.21636   , 235.77094   , 236.46188   , 233.56842   ,
                    233.56842   , 233.56842   , 234.214095  , 234.214095  ,
                    235.8463675 , 233.87845   , 233.87845   , 226.05782   ,
                    228.        ],
                [252.09241   , 255.35727333, 252.073346  , 250.787708  ,
                    250.56515333, 253.34643   , 249.36107   , 250.78225429,
                    251.10924   , 251.26375667, 246.78887   , 246.9956    ,
                    247.90068625, 248.8289075 , 243.884565  , 245.36876667,
                    240.96522   , 242.080385  , 240.81624   , 240.35214   ,
                    241.476224  , 239.4901    , 237.493235  , 236.74546   ,
                    239.21636   , 235.77094   , 236.46188   , 236.00771   ,
                    235.12602667, 234.90797667, 230.64889   , 230.839214  ,
                    232.03579   , 227.199265  , 225.05187333, 226.05782   ,
                    226.05782   ],
                [252.985735  , 252.312658  , 250.29306333, 247.98190889,
                    246.919925  , 245.10044667, 244.2571925 , 244.36593429,
                    243.60407333, 244.66546   , 244.66546   , 245.88049333,
                    245.88049333, 245.88049333, 240.35      , 238.81939   ,
                    240.96522   , 242.080385  , 240.81624   , 238.65660667,
                    238.65660667, 238.65660667, 237.493235  , 236.74546   ,
                    239.21636   , 235.77094   , 236.46188   , 230.83417   ,
                    230.83417   , 230.83417   , 227.31420667, 227.31420667,
                    227.31420667, 227.199265  , 222.28276   , 222.28276   ,
                    220.944025  ],
                [252.985735  , 252.312658  , 244.72629   , 244.72629   ,
                    244.72629   , 245.10044667, 243.52438   , 243.52438   ,
                    242.25849   , 242.25849   , 241.25175   , 240.031305  ,
                    241.4113025 , 240.10561   , 240.35      , 238.81939   ,
                    238.81939   , 239.46829   , 239.46829   , 238.677085  ,
                    238.677085  , 238.677085  , 234.01624   , 234.01624   ,
                    234.01624   , 235.77094   , 230.392915  , 230.392915  ,
                    230.392915  , 230.392915  , 226.64426333, 226.64426333,
                    226.64426333, 226.64426333, 222.28276   , 222.28276   ,
                    220.944025  ],
                [251.34524   , 247.96464   , 248.970472  , 248.970472  ,
                    248.970472  , 244.323455  , 244.323455  , 244.323455  ,
                    244.323455  , 242.25849   , 241.25175   , 242.7297825 ,
                    242.7297825 , 242.7297825 , 240.35      , 239.06232   ,
                    239.06232   , 239.46829   , 239.46829   , 239.118     ,
                    239.460066  , 233.282955  , 234.01624   , 234.01624   ,
                    232.99735   , 230.76316   , 230.76316   , 228.72906   ,
                    228.72906   , 228.72906   , 223.844615  , 223.844615  ,
                    223.844615  , 223.844615  , 225.55185   , 225.84466333,
                    230.33902   ],
                [251.34524   , 247.96464   , 247.40905333, 247.49574857,
                    247.49574857, 250.87596   , 245.46969667, 245.46969667,
                    245.46969667, 248.70909   , 249.01152   , 245.69211333,
                    245.69211333, 245.69211333, 241.39470333, 243.6626    ,
                    243.41176667, 241.39230333, 240.92387   , 238.14895667,
                    238.14895667, 238.14895667, 236.06916   , 236.06916   ,
                    232.99735   , 230.76316   , 230.76316   , 231.6194    ,
                    228.5267    , 227.52079   , 224.89224333, 224.89224333,
                    224.89224333, 226.65617667, 225.55185   , 225.84466333,
                    230.33902   ],
                [253.72987   , 253.55578   , 251.65761   , 250.89652   ,
                    250.386615  , 250.87596   , 250.749745  , 252.329405  ,
                    249.24994   , 248.70909   , 249.01152   , 246.208385  ,
                    247.71431667, 243.09399   , 241.39470333, 243.6626    ,
                    243.41176667, 241.39230333, 240.92387   , 239.37192   ,
                    239.52824   , 239.31181   , 236.6178    , 236.366585  ,
                    234.61484   , 233.206335  , 232.25586   , 231.21627   ,
                    229.50095667, 230.765615  , 227.4533    , 227.08915667,
                    227.105145  , 226.65617667, 225.55185   , 225.84466333,
                    230.33902   ],
                [252.0219    , 255.30476   , 255.95688   , 253.647025  ,
                    245.6944    , 245.6944    , 251.6813775 , 251.6813775 ,
                    251.6813775 , 248.70909   , 249.01152   , 248.26625667,
                    248.26625667, 248.26625667, 241.39470333, 243.6626    ,
                    243.41176667, 241.39230333, 240.92387   , 239.30369333,
                    239.30369333, 239.30369333, 236.6178    , 236.366585  ,
                    234.61484   , 233.206335  , 232.25586   , 232.16060667,
                    232.16060667, 232.16060667, 230.01094   , 230.01094   ,
                    230.01094   , 226.65617667, 234.67207   , 231.9972    ,
                    230.33902   ],
                [254.05931   , 255.30476   , 246.21308667, 246.21308667,
                    246.21308667, 248.27826   , 246.215725  , 246.215725  ,
                    246.215725  , 246.215725  , 243.97633333, 243.97633333,
                    243.97633333, 243.97633333, 243.97633333, 247.815825  ,
                    245.28644333, 244.68211   , 240.81868333, 240.81868333,
                    240.81868333, 240.81868333, 242.8656775 , 242.8656775 ,
                    240.112     , 240.112     , 236.29564667, 236.29564667,
                    236.29564667, 232.16060667, 232.69868333, 232.69868333,
                    232.69868333, 234.67207   , 234.67207   , 231.9972    ,
                    231.9972    ],
                [254.05931   , 254.05931   , 249.5709225 , 249.5709225 ,
                    249.5709225 , 248.27826   , 248.27826   , 249.59834   ,
                    249.59834   , 251.77179333, 250.31945   , 247.1240975 ,
                    247.1240975 , 247.1240975 , 248.8175    , 247.815825  ,
                    245.28644333, 244.68211   , 243.54393667, 243.365755  ,
                    242.8656775 , 242.8656775 , 242.8656775 , 241.13977   ,
                    240.736395  , 240.112     , 240.112     , 240.112     ,
                    240.264725  , 237.971865  , 238.9384025 , 238.9384025 ,
                    238.24815   , 237.4125    , 237.4125    , 241.26343   ,
                    241.26343   ],
                [251.99377   , 251.99377   , 251.819755  , 250.943754  ,
                    252.120485  , 250.836015  , 249.25161   , 252.88518833,
                    252.395965  , 251.77179333, 250.31945   , 251.63815   ,
                    250.051104  , 250.644875  , 248.8175    , 247.815825  ,
                    245.28644333, 244.68211   , 243.54393667, 243.365755  ,
                    242.65962667, 242.913012  , 243.5299    , 241.13977   ,
                    240.736395  , 240.78252   , 240.13799   , 240.12812   ,
                    240.264725  , 237.971865  , 240.0213    , 240.58821   ,
                    240.09987   , 241.486525  , 237.87384   , 241.26343   ,
                    241.26343   ],
                [251.99377   , 251.99377   , 254.00991   , 254.00991   ,
                    254.00991   , 250.836015  , 255.19362333, 255.19362333,
                    255.19362333, 256.153415  , 256.153415  , 249.248015  ,
                    249.248015  , 249.248015  , 248.8175    , 247.815825  ,
                    245.28644333, 244.68211   , 243.54393667, 243.365755  ,
                    247.0074    , 247.0074    , 247.0074    , 241.13977   ,
                    242.881955  , 242.881955  , 242.881955  , 240.12812   ,
                    243.76286   , 243.76286   , 241.43987   , 241.43987   ,
                    240.09987   , 241.486525  , 237.87384   , 241.26343   ,
                    241.26343   ]])

def ocean_circ(x, scale01=True, NPATHS=1, seed: Optional[int]=None,
               rng: Optional[np.random.Generator]=None):
    """
    Stochastic Ocean Circulation Model
    
    Dimensions 4. Longitude, latitude, and the diffusion coefficients Kx and Ky.
    
    Parameters
    ----------
    x : array_like
        Inputs of dimension (at least) 4.
    scale01 : bool, optional
        When True, inputs are expected to be given on unit interval. Default is True.
    NPATHS : int, optional
        How many simulations should be conducted for each set of inputs (the average is returned).
        Default is 1.
    
    Returns
    -------
    float
        Oxygen concentration.
    
    Notes
    -----
    A stochastic simulator that models the concentration of oxygen in a thin water
    layer (around 2000 m deep) in the South Atlantic ocean. For a specific
    location within the domain, random paths of the process are generated,
    producing noisy outcomes that approximate the solution to the PDE at that location.
    
    References
    ----------
    Baker, Evan, et al. "Analyzing stochastic computer models: a review with opportunities." 
    Statistical Science 37.1 (2022): 64-89.
    
    Herbei, Radu, and L. Mark Berliner. "Estimating ocean circulation: an MCMC approach 
    with approximated likelihoods via the Bernoulli factory." Journal of the American 
    Statistical Association 109.507 (2014): 944-954.
    """
    rng = np.random.default_rng(seed) if rng is None else rng

    # Define domain parameters
    xy = np.array([-34.0, 11.0, -32.0, -3.0])
    lat0 = -17.5
    domain = np.zeros(4)
    domain[0] = xy[0] * 111e3 * np.cos(lat0 * np.pi / 180.0)
    domain[1] = xy[1] * 111e3 * np.cos(lat0 * np.pi / 180.0)
    domain[2] = xy[2] * 111e3
    domain[3] = xy[3] * 111e3
    
    N = 37
    M = 19
    delx = (domain[1] - domain[0]) / (N - 1)
    dely = (domain[3] - domain[2]) / (M - 1)
    
    # Use pre-loaded velocity fields
    U = U_DATA
    V = V_DATA
    OXY = OXY_DATA
    
    # Unnormalize inputs
    long = x[0] * (domain[1] - domain[0]) + domain[0]
    lat = x[1] * (domain[3] - domain[2]) + domain[2]
    KX = x[2] * 900 + 100
    KY = x[3] * 900 + 100
    
    # Call the simulator
    sim_results = _fk_simulator(domain, np.array([[long, lat]]), U, V, KX, KY, OXY, NPATHS, rng)
    return np.mean(sim_results)

def _fk_simulator(domain, sites, U, V, KX, KY, OXY, NPATHS, rng: np.random.Generator):
    """
    Private Ocean Circulation simulator.
    
    Parameters
    ----------
    domain : array_like
        Domain boundaries.
    sites : array_like
        Locations at which to compute oxygen concentration.
    U, V : ndarray
        Velocity fields.
    KX, KY : float
        Diffusion coefficients.
    OXY : ndarray
        Oxygen concentration grid.
    NPATHS : int
        Number of random paths to generate.
    
    Returns
    -------
    ndarray
        Simulated oxygen concentrations.
    """
    M, N = OXY.shape
    delx = (domain[1] - domain[0]) / (N - 1)
    dely = (domain[3] - domain[2]) / (M - 1)
    NOBS = sites.shape[0]
    HH = 1e7
    lam = 1e-11
    
    OUT = np.zeros((NOBS, NPATHS))
    
    for i in range(NOBS):
        for kk in range(NPATHS):
            xc = sites[i, 0]
            yc = sites[i, 1]
            
            tau = 0
            while ((xc - domain[0]) * (xc - domain[1]) < 0) and ((yc - domain[2]) * (yc - domain[3]) < 0):
                # Find grid indices
                jx = int(np.ceil((xc - domain[0]) / delx))
                ix = int(np.ceil((yc - domain[2]) / dely))
                
                # Ensure indices are within bounds
                jx = min(jx, N)
                jx = 1 if jx<=0 else jx
                ix = min(ix, M)
                ix = 1 if ix<=0 else ix
                
                # Get velocity at current location
                uc = U[ix, jx]
                vc = V[ix, jx]
                
                # Euler step with random diffusion
                xn = xc + HH * uc + np.sqrt(HH) * np.sqrt(2 * KX) * rng.normal()
                yn = yc + HH * vc + np.sqrt(HH) * np.sqrt(2 * KY) * rng.normal()
                
                xc = xn
                yc = yn
                tau += HH
            
            # Find final grid indices
            JJ = int(np.ceil((xc - domain[0]) / delx))
            II = int(np.ceil((yc - domain[2]) / dely))
            
            # Ensure indices are within bounds
            JJ = max(0, min(JJ, N-1))
            II = max(0, min(II, M-1))
            
            OUT[i, kk] = OXY[II, JJ] * np.exp(-lam * tau)
    
    return OUT

# Register function with metadata
register_function(
    fname="ocean_circ",
    input_dim=4,
    input_cat=False,
    response_type="uni",
    stochastic="y",
    input_range=np.array([
        [0, 1],
        [0, 1],
        [0, 1],
        [0, 1]
    ])
)
